Сорсы здесь https://source.dot.net

# План

* Понять, как сгенерировать ответ на запрос
* Какой это может быть ответ
* Как прочитать\записать содержимое запроса\ответа
* Как контроллер получает запрос и что этот запрос представляет собой

# Вопросы

* Насколько корректно с концептуальной точки зрения использовать ApiController? Ведь есть ControllerBase. И использовать пространство System.Net в веб-приложении. Ну или хотя бы смешивать System.Web и System.Net

# Пространства

* System.Net ([msdn](https://docs.microsoft.com/ru-ru/dotnet/api/system.net?view=net-5.0))
* System.Web ([msdn](https://docs.microsoft.com/ru-ru/dotnet/api/system.web?view=net-5.0))

В основе такого разделения лежит принцип, что `.Net` - для обеспечения сетевыми функциями обычных приложений, например, настольных, а `.Web` - для веб-приложений. Соответственно, в пространстве `.Net` и вложенных - нет никаких контроллеров и прочих элементов, характерных для веб-приложений. Но при этом, теоретически, ничто не мешает пользоваться классами из .Net в веб-приложениях, если при этом не возникает конфликтов имен классов. Правда я не знаю, насколько это корректно.

Внутри .Web есть разделение на:

* **.Mvc** - MVC контроллеры
* **.Http** - Web API контроллеры

Это связано с тем, что в ASP MVC 5 приложения более явно делятся на MVC и на Web API соответственно (в ASP Core они уже не разделяются). В разных пространствах можно найти классы с одинаковыми именами:

![image-20210629100807383](img/image-20210629100807383.png)

Помня о таком разделении, проще понимать дальнейшую разницу, например, в контроллерах.

# Контроллеры

## ApiController

ApiController ← Object
Пространство System.Web.Http

Действия могут возвращать:

* HttpResponseMessage ← Object, System.Net.Http
* IHttpActionResult, System.Web.Http



# Классы



* HttpResponseMessage ← Object, System.Net.Http

# Запрос, ответ

```c#
HttpRequestMessage < Object
HttpResponseMessage < Object
HttpContent < Object
HttpContentHeaders < HttpHeaders < Object
HttpMethod < Object
Uri < Object
```

Являются частью фреймворка, а не asp. Почти все находятся в пространстве `System.Net.Http`

<img src="img/image-20210628170727304.png" alt="image-20210628170727304" style="zoom:80%;" />

Ответ содержит ссылку на запрос. `IsSuccessfullStatusCode` возвращает true, если код находится в пределах 200.

# Контент

https://docs.microsoft.com/ru-ru/dotnet/api/system.net.http.httprequestmessage.content?view=net-5.0#System_Net_Http_HttpRequestMessage_Content

Сюда бы вписать как контент читать\писать

# Результат действия

HttpResponseMessage
IHttpActionResult
Произвольный тип

У контроллера есть свойство `Request` типа



# Контроллеры

Персонажи: ControllerBase, Controller, ApiController



