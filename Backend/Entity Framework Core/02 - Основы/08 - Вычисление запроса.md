# Вычисление запроса

<img src="img\image-20200503110254759.png" alt="image-20200503110254759"  />

Этапы оформления запроса и получения данных разделены. Это означает, что при написании, например, вот такого кода:

```c#
var users = context.Users.Where(u => u.County == "Russia");
```

в переменной users пока еще нет никаких данных. Это позволяет формировать запросы, постепенно дописывая условия или другие операции:

```c#
var users = context.Users.Where(u => u.County == "Russia");
users = users.Where(u => u.Age > 30);
var data = users.ToList();
```

Здесь только в последней строчке запускается процесс получения данных, потому что к запросу применяется метод `ToList`.

Вот список методов, которые инициируют выполнение запроса:

<img src="img\image-20200503112028181.png" alt="image-20200503112028181" style="zoom:80%;" />



Кроме этого, попытка обойти элементы тоже инициирует выполнение запроса:

```c#
var users = context.Users.Where(u => u.County == "Russia");
foreach (var user in users) 
{ 
    user.Country = "Russian Federation";
}
context.SaveChanges();
```

Этот вариант характеризуется тем, что соединение с БД будет оставаться открытым на протяжении всего времени, пока крутится цикл. И если в нем находятся тяжелые операции, то и соединение будет висеть очень долго, а нужно стараться минимизировать это время.

Поэтому хорошей практикой считается выполнение запроса и получение данных в память *до* их обхода:

```c#
var users = context.Users.Where(u => u.County == "Russia").ToList();
foreach (var user in users) 
{ 
    user.Country = "Russian Federation";
}
context.SaveChanges();
```
