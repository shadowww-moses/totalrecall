# Тестирование EF

* Добавляем в решение проект с типом тест. В данном примере используется `MsTest`

  <img src="img\image-20200509091649278.png" alt="image-20200509091649278" style="zoom:80%;" />

* Настраиваем ссылки на сборки, типы которых будем тестировать

* Устанавливать пакеты EFCore в сборку с тестами не нужно

* Меняем в контексте имя рабочей базы на тестовую. Достаточно просто изменить имя, а база потом создастся, если ее не существует

## Тестирование настоящей БД

<img src="img\image-20200509092014962.png" alt="image-20200509092014962" style="zoom:80%;" />

Здесь используется реальная база данных, поэтому тест будет выполняться долго, потому что много времени будет тратиться на удаление и создание БД.

## Запуск тестов

Окно со списком тестов открывается через главное меню `Test > Test Explorer`

<img src="img\image-20200509092554351.png" alt="image-20200509092554351" style="zoom:80%;" />

После выполнения теста можно посмотреть полный список операций, который при этом выполнился, нажав на `Open additional output for this result`

## InMemory тестирование

Позволяет значительно ускорить выполнение тестов, хотя имеет некоторые отличия по сравнению с реальной базой. Например, Id при сохранении объектов формируются по-другому.

* Устанавливаем пакет `Microsoft.EntityFrameworkCore.InMemory`

* Вносим изменения в контекст:

  <img src="img\image-20200509093035645.png" alt="image-20200509093035645" style="zoom:80%;" />

  Смысл в том, что если мы теперь не передадим в конструктор контекста опции создания, то сработает условие в методе `OnConfiguring` и произойдет настройка на обычную базу. Если передадим, то в этих опциях сможем указать тестовую базу и настройка пойдет на нее.

* В самом тесте теперь передаем в конструктор контекста соответствующие настройки (CanInsertUser в данном случае это имя, которая получит БД в памяти):

  <img src="img\image-20200509093605084.png" alt="image-20200509093605084" style="zoom:80%;" />
